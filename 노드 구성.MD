# NewSum LangGraph ë…¸ë“œë³„ ê°œë°œ ê³„íšì„œ

> **ë²”ìœ„**Â : ê¸°ì¡´ì— ì¬êµ¬ì„±í•œ *NewSum* ì›Œí¬í”Œë¡œìš°ì˜ ê° ë…¸ë“œë¥¼ ì‹¤ì œ ì½”ë“œë¡œ êµ¬í˜„í•˜ê¸° ìœ„í•œ **ë¡œì§ ì¤‘ì‹¬** ê°œë°œ ê°€ì´ë“œì…ë‹ˆë‹¤. íŒŒì¼Â·í´ë˜ìŠ¤ êµ¬ì¡°ë‚˜ ì™¸ë¶€ ì¸í”„ë¼ ì„¤ì •ì€ ì´ë¯¸ ì •í•´ì ¸ ìˆë‹¤ëŠ” ê°€ì •í•˜ì—, ë…¸ë“œë§ˆë‹¤ **ëª©ì Â·ì…ì¶œë ¥(State)Â·í•µì‹¬ í•¨ìˆ˜Â·ì ê²€ ëª©ë¡**ë§Œ ê¸°ìˆ í•©ë‹ˆë‹¤.

---

## ì „ì—­ ê·œì¹™

| í•­ëª©           | ê·œì¹™                                                                     |
| ------------ | ---------------------------------------------------------------------- |
| **ì–¸ì–´**       | ì½”ë“œ ì£¼ì„Â·State í‚¤ **EN**, SLM í”„ë¡¬í”„íŠ¸ **EN**, **ì‚¬ìš©ìì™€ì˜ ëª¨ë“  ì˜ì‚¬ì†Œí†µÂ·ë³´ê³ ì„œÂ·UI ì¶œë ¥ì€ KR** |
| **State ê²½ë¡œ** | `state[<node_key>]` (ìŠ¤ë„¤ì´í¬ ì¼€ì´ìŠ¤)                                         |
| **ì‹œê°„ëŒ€**      | ISOâ€‘8601, ê¸°ë³¸ Asia/Seoul                                                |
| **SLM**      | ë¡œì»¬ ê²½ëŸ‰ ëª¨ë¸ë§Œ ì‚¬ìš©(`slm_generate(prompt, mode=â€¦)`)Â â€” ì™¸ë¶€ LLM API í˜¸ì¶œ ê¸ˆì§€        |
| **ìœ ì‚¬ë„**      | TFâ€‘IDFÂ +Â ì½”ì‚¬ì¸: ê¸°ì‚¬Â 0.80 ì´ìƒ, ê²Œì‹œê¸€Â 0.85 ì´ìƒ ê·¸ë£¹í•‘                              |
| **ë„ë©”ì¸**      | `db.trusted_domains`ì—ì„œ ì½ê¸° ì „ìš©Â â€” ëŸ°íƒ€ì„ ë­í‚¹ ì—†ìŒ                               |
| **íŒŒì¼ ì €ì¥**    | `save_json`, `save_markdown` í—¬í¼ ì‚¬ìš©                                     |

---

## 1ï¸âƒ£ TopicClarificationNode (`topic_clarification`)

### ëª©ì 

ì›ë³¸ ì‚¬ìš©ì ì¿¼ë¦¬ë¥¼ **ë‰´ìŠ¤Â·ìœ„í‚¤ 1ì°¨ íƒìƒ‰ â†’ SLM ìš”ì•½** ê³¼ì •ì„ ê±°ì³ *300ì ë‚´ì™¸*ì˜Â êµ¬ì²´ ì£¼ì œë¡œ í™•ì •í•œë‹¤. í•„ìš”í•˜ë©´ `question/answer`Â ë£¨í”„ë¥¼ í†µí•´ ì¶”ê°€ ì§ˆì˜Â·ì‘ë‹µì„ ìˆ˜í–‰í•œë‹¤.

### State I/O

```jsonc
{"user_query":"â€¦",
 "topic_clarification":{
   "draft":"",
   "question":null,
   "answers":[],
   "is_final":false}}
```

### í•µì‹¬ í•¨ìˆ˜

| í•¨ìˆ˜                                          | ì—­í•                     |
| ------------------------------------------- | --------------------- |
| `fetch_initial_sources(query)`              | ë‰´ìŠ¤Â·ìœ„í‚¤ ìŠ¤í¬ë© â†’ ë©”íƒ€ë°ì´í„° ë¦¬ìŠ¤íŠ¸ |
| `aggregate_search_context(srcs)`            | ì œëª©Â·ìŠ¤ë‹ˆí« ë³‘í•© â‰¤500ì       |
| `generate_topic_draft(ctx)`                 | SLM ìš”ì•½ â†’ 300ì ì´ˆì•ˆ      |
| `is_topic_sufficient(draft)`                | ê¸¸ì´Â·í‚¤ì›Œë“œÂ·ëª¨í˜¸ì„± ê²€ì‚¬         |
| `formulate_followup_question(draft,q)`      | ë¶€ì¡± ë¶€ë¶„ **í•œêµ­ì–´ ì§ˆë¬¸** ìƒì„±   |
| `process_user_response(question,answer,st)` | ë‹µë³€ ë°˜ì˜Â·`is_final` ê²°ì •   |

### TODO

*

---

## 2ï¸âƒ£ ReportSearchPlanningNode (`report_planning`)

### ëª©ì 

í™•ì • ì£¼ì œë¥¼ ë°”íƒ•ìœ¼ë¡œ \*\*ë³´ê³ ì„œ êµ¬ì¡°(ì„¹ì…˜Â·ì†Œì œëª©)\*\*ì™€ \*\*ê²€ìƒ‰Â ê³„íš(5W ê¸°ë°˜ ë‹¨ê³„ë³„ ì¿¼ë¦¬+ë„ë©”ì¸)\*\*ì„ ìˆ˜ë¦½í•œë‹¤.
ë˜í•œ ê³„íšì´ ë¶ˆì¶©ë¶„í•  ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ **ì‚¬ìš©ì í”¼ë“œë°± ë£¨í”„**ë¥¼ ë‚´ì¥í•œë‹¤.

### StateÂ I/O

```jsonc
{"report_planning":{
  "structure":{},              // ë³´ê³ ì„œ ì„¹ì…˜ íŠ¸ë¦¬
  "search_plan":[],            // [{step_name, query, domains}]
  "planning_question":null,    // ì‚¬ìš©ìì—ê²Œ ë˜ì§„ ì§ˆë¬¸
  "planning_answer":null,      // ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë‹µë³€
  "is_ready":false             // trueÂ â†’ ë‹¤ìŒ ë…¸ë“œ ì§„í–‰
}}
```

### í•µì‹¬ í•¨ìˆ˜

| í•¨ìˆ˜                                         | ì—­í•                                  |
| ------------------------------------------ | ---------------------------------- |
| `define_report_structure(topic)`           | ì„¹ì…˜ & ì†Œì œëª© ê¸°ë³¸ í‹€ ìƒì„±                   |
| `plan_search_steps(structure)`             | 5W ê¸°ë°˜ ì¡°ì‚¬ ë‹¨ê³„ ë¦¬ìŠ¤íŠ¸ ì‘ì„±                 |
| `formulate_search_queries(steps,domains)`  | ë‹¨ê³„ë³„ ì‹¤ì œ ê²€ìƒ‰ì–´ ìƒì„±Â + ë„ë©”ì¸ ê²°í•©             |
| `check_planning_sufficiency(plans)`        | ë‹¨ê³„Â·ì¿¼ë¦¬ ì™„ê²°ì„± ê²€ìˆ˜(ê¸¸ì´Â·í‚¤ì›Œë“œÂ·ë„ë©”ì¸ í¬í•¨)        |
| `generate_planning_question(plans)`        | ë¶€ì¡±í•  ë•Œ ì‚¬ìš©ìì—ê²Œ ë³´ë‚¼ **í•œêµ­ì–´ ì§ˆë¬¸** ìƒì„±       |
| `process_planning_response(answer, plans)` | ë‹µë³€ì„ ë°˜ì˜í•´ ì¿¼ë¦¬Â·ë‹¨ê³„ë¥¼ ë³´ê°•í•˜ê³  `is_ready` ì¬ê³„ì‚° |

### í”¼ë“œë°± ë£¨í”„ ì‹œë‚˜ë¦¬ì˜¤

1. **ì´ˆì•ˆ ìƒì„±** â†’ `is_ready=false`, `planning_question` ì„¸íŒ….
2. UIÂ ë ˆì´ì–´ê°€ `planning_question`ì„ ì‚¬ìš©ìì—ê²Œ ë…¸ì¶œÂ·ë‹µë³€ì„ `planning_answer`ì— ê¸°ë¡.
3. ë…¸ë“œ ì¬ì‹¤í–‰ â†’ `process_planning_response` ë¡œì§ì´ ìˆ˜ì •Â·ë³´ê°•.
4. `check_planning_sufficiency` ë§Œì¡± ì‹œ `is_ready=true`, `planning_question`Â ë°Â `planning_answer`ë¥¼ `null`ë¡œ ì´ˆê¸°í™”.

### TODO

*

---

## 3ï¸âƒ£ SearchExecutionNode (`source_collect`)

### ëª©ì 

ê²€ìƒ‰ ê³„íšì„ ì‹¤í–‰í•˜ì—¬ ê¸°ì‚¬ ìˆ˜ì§‘ â†’ **ì í•©ì„± í•„í„°Â·ìœ ì‚¬ë„ í´ëŸ¬ìŠ¤í„°ë§** â†’ ìš”ì•½ ì •ë³´ë¥¼ ì¶”ì¶œí•œë‹¤.

### State ìŠ¤í‚¤ë§ˆ(ìš”ì•½)

```jsonc
{"source_collect":{"groups":[{"id":0,"urls":[â€¦],"rep_title":"â€¦","summary":"â€¦"}]}}
```

### í•µì‹¬ í•¨ìˆ˜

* `execute_web_query(query,domains)`
* `filter_relevant_pages(pages,topic)`
* `compute_similarity(pages)`
* `dedupe_and_group(pages,sims)`
* `extract_key_content(groups,pages)`

### TODO

*

---

## 4ï¸âƒ£ ReportSynthesisNode (`report_draft`)

### ëª©ì 

ë³´ê³ ì„œ êµ¬ì¡° + ê·¸ë£¹ ìš”ì•½ì„ ë°”íƒ•ìœ¼ë¡œ **í•œêµ­ì–´** HTML ë³´ê³ ì„œë¥¼ Jinja2 í…œí”Œë¦¿ìœ¼ë¡œ ë Œë”ë§í•˜ê³ , **Stateì—ë„ ì „ë¬¸ì„ ì €ì¥**í•œë‹¤. (ì‚¬ìš©ì í”¼ë“œë°± ë£¨í”„ ì—†ìŒ)

### State I/O (ì¶”ê°€)

```jsonc
"report_draft": {
  "html_path": "reports/20250604_6g.html",  // íŒŒì¼ ì €ì¥ ìœ„ì¹˜
  "html_content": "<html>â€¦</html>"        // ì „ì²´ HTML ë¬¸ìì—´ (KR)
}
```

### í•µì‹¬ í•¨ìˆ˜

| í•¨ìˆ˜                                              | ì„¤ëª…                                               |
| ----------------------------------------------- | ------------------------------------------------ |
| `assemble_full_report(structure, groups)`       | ì„¹ì…˜ë³„ ìˆœìˆ˜ KR í…ìŠ¤íŠ¸ ë”•ì…”ë„ˆë¦¬ ë°˜í™˜                            |
| `render_html_jinja(report_dict, template_path)` | Jinja2 â†’ KR HTML ë¬¸ìì—´                             |
| `save_report_html(html_str, path)`              | íŒŒì¼ë¡œ ì €ì¥í•˜ê³  `state.html_content`ì™€ `html_path` ëª¨ë‘ ê¸°ë¡ |

### TODO

*

---

## 5ï¸âƒ£ CommunitySearchPlanningNode (`community_plan`)

### ëª©ì 

ìµœì¢… ë³´ê³ ì„œë¥¼ ê¸°ë°˜ìœ¼ë¡œ **êµ­ë‚´â€‘KR ì»¤ë®¤ë‹ˆí‹° ì „ì²´**ì™€ **í•´ì™¸â€‘US ì»¤ë®¤ë‹ˆí‹° ì „ì²´**ì—ì„œ ì‚¬ìš©ìê°€ ì–´ë–¤ í‘œí˜„ìœ¼ë¡œ ê¸€ì„ ë‚¨ê²¼ì„ì§€ SLMì´ ì¶”ë¡ í•˜ê³ , **ì–¸ì–´ì— ë§ì¶˜ ê²€ìƒ‰ì–´ ì„¸íŠ¸**ë¥¼ ì„¤ê³„í•œë‹¤.

*í¬ì¸íŠ¸*

1. `db.trusted_domains`ì—ëŠ” `locale`Â í•„ë“œê°€ ìˆìœ¼ë©°, `KR`/`US` ë¡œì»¬ ê°’ìœ¼ë¡œ ì»¤ë®¤ë‹ˆí‹°ê°€ êµ¬ë¶„ë¨.
2. **KRÂ ê²€ìƒ‰ì–´**ëŠ” ëª¨ë“  `KR` ë„ë©”ì¸ì„ `site:` í•„í„°ë¡œ **OR** ì—°ê²°í•œ ë‹¨ì¼ ì¿¼ë¦¬(or ì—¬ëŸ¬ ìš°ì„ ìˆœìœ„ ì¿¼ë¦¬).
3. **USÂ ê²€ìƒ‰ì–´**ë„ ë™ì¼í•˜ê²Œ ëª¨ë“  `US` ë„ë©”ì¸ì„ ë¬¶ì–´ ì‘ì„±.
4. SLMì€ ë³´ê³ ì„œ í•µì‹¬ í‚¤ì›Œë“œë¥¼ ì–¸ì–´ë³„ë¡œ ë³€í™˜Â·í™•ì¥ í›„, ì»¤ë®¤ë‹ˆí‹° ê¸€ì—ì„œ í”íˆ ì“°ì¼ í‘œí˜„(ì€ì–´Â·í•´ì‹œíƒœê·¸Â·ì•½ì–´ ë“±)ì„ í¬í•¨í•´ ê²€ìƒ‰ì–´ë¥¼ ì¶”ì²œ.
5. ì‚¬ìš©ì í”¼ë“œë°± ë£¨í”„ëŠ” í•„ìš” ì—†ìœ¼ë©°, ìë™ìœ¼ë¡œ ìµœì  ì¿¼ë¦¬ ì„¸íŠ¸ë¥¼ ì‚°ì¶œ.

### State I/O

```jsonc
{"community_plan":{
  "queries": [
    {"locale":"KR", "query":"â€¦", "priority":0.9},
    {"locale":"US", "query":"â€¦", "priority":0.85}
  ],
  "is_ready": true
}}
```

### í•µì‹¬ í•¨ìˆ˜

| í•¨ìˆ˜                                         | ì—­í•                                             |
| ------------------------------------------ | --------------------------------------------- |
| `parse_report_for_keywords(report_path)`   | ë³´ê³ ì„œ â†’ í•µì‹¬ í‚¤ì›Œë“œ(ì¤‘ë³µ ì œê±°) ì¶”ì¶œ                        |
| `localize_keywords(keywords)`              | `{ ko: [..], en: [..] }`Â í•œÂ·ì˜ ë§¤í•‘ (ë²ˆì—­Â·ìŒì—­ í¬í•¨)    |
| `infer_community_phrases(local_kw, en_kw)` | SLMì´ ì»¤ë®¤ë‹ˆí‹°ì‹ í‘œí˜„/ì€ì–´/í•´ì‹œíƒœê·¸ í™•ì¥                      |
| `build_locale_query(keywords, domains)`    | í‚¤ì›Œë“œ ë¦¬ìŠ¤íŠ¸Â + ëª¨ë“  ë„ë©”ì¸(OR)Â â†’ ì™„ì„± ì¿¼ë¦¬                  |
| `assemble_queries(kw_map, domain_map)`     | KR/US ê°ê° `build_locale_query` í˜¸ì¶œ, priority ë¶€ì—¬ |
| `validate_queries(queries)`                | ì¿¼ë¦¬ ë¬¸ìì—´Â·ë„ë©”ì¸ í•„í„° ì •ìƒ ì—¬ë¶€ ê²€ì¦                        |

### íë¦„ ìš”ì•½

1. **í‚¤ì›Œë“œ ì¶”ì¶œ**Â â†’Â `parse_report_for_keywords`
2. **í•œÂ·ì˜ ë¶„í• Â·í™•ì¥**Â â†’Â `localize_keywords`Â &Â `infer_community_phrases`
3. **ë„ë©”ì¸ ì§‘í•© ì½ê¸°**Â â†’Â `db.trusted_domains where locale='KR'/'US'`
4. \*\*`build_locale_query`\*\*ë¡œ `KR`/`US` ì¿¼ë¦¬ ê°ê° ìƒì„±
5. **`assemble_queries`**: priority ê³„ì‚°(í‚¤ì›Œë“œ ìˆ˜Â·ì‹ ì„ ë„) í›„ `state.community_plan.queries` ì €ì¥
6. **ê²€ì¦**Â â†’Â `validate_queries`ê°€ í†µê³¼í•˜ë©´ `is_ready=true`

### TODO

*

---

## 6ï¸âƒ£ CommunityCollectionNode (`community_collect`)

### ëª©ì 

ì»¤ë®¤ë‹ˆí‹° ì¿¼ë¦¬ ì‹¤í–‰ â†’ ê²Œì‹œë¬¼ ìˆ˜ì§‘ â†’ **ì í•©ì„±Â·ìœ ì‚¬ë„** ì²˜ë¦¬ í›„ ëŒ€í‘œ ìŠ¤ë‹ˆí« ì €ì¥.

### TODO

*

---

## 7ï¸âƒ£ CommunityAnalysisNode (`community_analysis`)

### ëª©ì 

ê²Œì‹œê¸€ì„ ë¶„ì„í•˜ì—¬ **ê°ì„± ë¶„í¬Â·í•µì‹¬ í† í”½Â·ì£¼ìš” ì¸ìš©** ì¶”ì¶œ.

### í•µì‹¬ í•¨ìˆ˜

* `perform_sentiment_analysis(posts)`
* `extract_discussion_topics(posts)`
* `summarize_trends(posts)`

### TODO

*

---

## 8ï¸âƒ£ ComicOutlineNode (`comic_outline`)

### ëª©ì 

ë³´ê³ ì„œ(ë…¸ë“œÂ 4)ì™€ ì»¤ë®¤ë‹ˆí‹° ì¸ì‚¬ì´íŠ¸(ë…¸ë“œÂ 7)ë¥¼ ë°”íƒ•ìœ¼ë¡œ **ì—¬ëŸ¬ ê°œì˜ 4ì»· ë§Œí™” í”Œë¡¯ í›„ë³´**ë¥¼ ìƒì„±í•œë‹¤. ê° í”Œë¡¯ì€ ë‹¤ì–‘í•œ ì½”ë¯¹ ê¸°ë²•ì„ ì¡°í•©í•˜ì—¬ ì¬ë¯¸ì™€ ì „ë‹¬ë ¥ì„ ë†’ì¸ë‹¤. ìƒì„±ëœ í›„ë³´ë¥¼ ì‚¬ìš©ìì—ê²Œ ì œì‹œâ€‘í”¼ë“œë°±ì„ ë°›ì•„ ìµœì¢… í”Œë¡¯ì„ í™•ì •í•˜ëŠ” **í•œêµ­ì–´ í”¼ë“œë°± ë£¨í”„**ë¥¼ í¬í•¨í•œë‹¤.

### ì‚¬ìš© ê¸°ë²•(ì˜ˆì‹œ)

```
Exaggeration(ê³¼ì¥) Â· Understatement(ì ˆì œ) Â· Irony(ì•„ì´ëŸ¬ë‹ˆ) Â· Parody
Juxtaposition(ëŒ€ì¡°) Â· Symbolism(ìƒì§•) Â· Wordplay/Puns(ì–¸ì–´ìœ í¬)
Characterization(ì˜ì¸í™”) Â· Reversal(ë°˜ì „) Â· Satirical Analogy(í’ì) Â· Absurdity(ë¶€ì¡°ë¦¬)
```

### StateÂ I/O

```jsonc
"comic_outline": {
  "candidates": [   // 1íšŒ ì‹¤í–‰ ì‹œ 3~5ê°œ ìƒì„±
    {"id": 0, "panels": [...], "techniques": ["Irony","Parody"], "pitch": "â€¦"},
    {"id": 1, "panels": [...], "techniques": ["Juxtaposition","Symbolism"], "pitch": "â€¦"}
  ],
  "question": "ì–´ëŠ í”Œë¡¯ì´ ê°€ì¥ ë§ˆìŒì— ë“œì‹œë‚˜ìš”? (ìˆ«ì ì„ íƒ)
ì¶”ê°€í•˜ê³  ì‹¶ì€ ì•„ì´ë””ì–´ê°€ ìˆìœ¼ë©´ ììœ ë¡­ê²Œ ì ì–´ì£¼ì„¸ìš”!",
  "user_choice": null,        // ìˆ«ì ë˜ëŠ” null
  "user_feedback": null,      // ììœ  ì„œìˆ ì‹ ì˜ê²¬(ë¬¸ìì—´)
  "final_outline": null,      // í™•ì •ëœ ë‹¨ì¼ í”Œë¡¯ (panels ë°°ì—´)
  "is_final": false
}
```

### í•µì‹¬ í•¨ìˆ˜

| í•¨ìˆ˜                                                                | ì—­í•                                                               |
| ----------------------------------------------------------------- | --------------------------------------------------------------- |
| `generate_outline_candidates(report_txt, community_insight, n=4)` | SLMìœ¼ë¡œ **nê°œ í”Œë¡¯ í›„ë³´** ìƒì„± (ë‹¤ì–‘ ê¸°ë²• ì¡°í•©)                                |
| `pitch_outline(outline)`                                          | í”Œë¡¯ ê°•ì ì„ 1â€‘2ë¬¸ì¥ ìš”ì•½(Pitch)                                          |
| `build_question(cands)`                                           | í›„ë³´ idÂ·pitch + "ì¶”ê°€ ì•„ì´ë””ì–´ ì…ë ¥ë€" í¬í•¨ **í•œêµ­ì–´ ì§ˆë¬¸** ìƒì„±                    |
| `apply_user_feedback(cands, feedback)`                            | ììœ  ì˜ê²¬ ë¬¸ì¥ì„ ë¶„ì„í•´ í›„ë³´ì— ë°˜ì˜(ê¸°ë²• ì¶”ê°€Â·íŒ¨ë„ ìˆ˜ì •)                               |
| `process_user_choice(choice, feedback, cands)`                    | `user_choice` í™•ì¸ í›„ `(apply_user_feedback)` â†’ `final_outline` í™•ì • |
| `fallback_auto_select(cands)`                                     | 2íšŒ ì§ˆë¬¸ì—ë„ ì‘ë‹µ ì—†ìœ¼ë©´ priority ìµœê³  í”Œë¡¯ ìë™ ì„ íƒ                             |

### í”¼ë“œë°± ë£¨í”„

1. **í›„ë³´ ìƒì„±** â†’ `candidates` + `question` ì„¸íŒ…(`is_final=false`).
2. UIê°€ ì§ˆë¬¸/í›„ë³´ë¥¼ ì‚¬ìš©ìì—ê²Œ í‘œì¶œ â†’ `user_choice` ë° `user_feedback` ê¸°ë¡ ê°€ëŠ¥.
3. ë…¸ë“œ ì¬ì‹¤í–‰ â†’ `process_user_choice`:

   * a) `user_choice` ìœ íš¨Â·`user_feedback`Â ë¹„ì–´ ìˆìŒÂ â†’ í•´ë‹¹ í›„ë³´ í™•ì •.
   * b) `user_feedback`Â ì¡´ì¬Â â†’ `apply_user_feedback`ë¡œ í›„ë³´ ë³´ê°• í›„ í™•ì • ê¶Œê³ .
   * c) ì…ë ¥ ì˜¤ë¥˜Â â†’ ì˜¤ë¥˜ ë©”ì‹œì§€ í¬í•¨ ìƒˆ ì§ˆë¬¸.
4. `is_final=true`ê°€ ë˜ë©´ PanelDetailNode ë¡œ ì´ë™.

### TODO

* [ ] `apply_user_feedback`Â : í‚¤ì›Œë“œ ë§¤ì¹­ìœ¼ë¡œ íŒ¨ë„ ì‚½ì…/ì‚­ì œ, ê¸°ë²• ì¶”ê°€ ë¡œì§
* [ ] `pitch_outline` 80ì ì´í•˜ ìš”ì•½ ì œí•œ
* [ ] ë‹µë³€ íƒ€ì„ì•„ì›ƒÂ 2íšŒ â†’ `fallback_auto_select` ì‹¤í–‰

---

## 9ï¸âƒ£ PanelDetailNode (`panel_details`)

### ëª©ì 

ê° íŒ¨ë„ì„ **ë“±ì¥ì¸ë¬¼Â·ì¥ë©´Â·ëŒ€ì‚¬**ê¹Œì§€ ì„¸ë¶„í™”.

### TODO

* [ ] â€¦

\--- PanelDetailNode (`panel_details`)

### ëª©ì 

ê° íŒ¨ë„ì„ **ë“±ì¥ì¸ë¬¼Â·ì¥ë©´Â·ëŒ€ì‚¬**ê¹Œì§€ ì„¸ë¶„í™”.

### TODO

*

---

## ğŸ”Ÿ PromptAssemblyNode (`image_prompts`)

### ëª©ì 

ì„¸ë¶€ íŒ¨ë„ ì •ë³´ + ìŠ¤íƒ€ì¼ í…œí”Œë¦¿ â†’ **SDXL ìµœì¢… í”„ë¡¬í”„íŠ¸** ìƒì„± **ë°** í”„ë¡¬í”„íŠ¸ë¥¼ "ì´ë¯¸ì§€ ìƒì„± í í…Œì´ë¸”"ì— **ì˜ˆì•½(enqueue)** í•œë‹¤.

* í í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ(ì˜ˆì‹œ): `queue_id | panel_id | prompt | status | created_at`
* ì˜ˆì•½ëœ ë ˆì½”ë“œëŠ” ë‹¤ìŒ ë°°ì¹˜(worker)ì—ì„œ SDXL í˜¸ì¶œ ëŒ€ìƒìœ¼ë¡œ ì†Œë¹„ëœë‹¤.

### State I/O

```jsonc
"image_prompts": {
  "prompts": [ {"panel_id": 1, "prompt": "â€¦"}, â€¦ ],
  "queue_ids": [42, 43, 44]   // DB insert ë°˜í™˜ PK ëª©ë¡
}
```

### í•µì‹¬ í•¨ìˆ˜

| í•¨ìˆ˜                                         | ì—­í•                                    |
| ------------------------------------------ | ------------------------------------ |
| `assemble_single_prompt(detail, template)` | ë‹¨ì¼ íŒ¨ë„ â†’ í”„ë¡¬í”„íŠ¸ ë¬¸ìì—´ ì¡°ë¦½                  |
| `assemble_all_prompts(details, template)`  | ëª¨ë“  íŒ¨ë„ í”„ë¡¬í”„íŠ¸ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜                    |
| `enqueue_prompts(prompts, queue_table)`    | ê° í”„ë¡¬í”„íŠ¸ë¥¼ DB í í…Œì´ë¸”ì— INSERT â†’ PK ë¦¬ìŠ¤íŠ¸ ë°˜í™˜ |
| `save_prompts_state(prompts, pk_list)`     | `state.image_prompts` ì—…ë°ì´íŠ¸           |

### TODO

* [ ] í í…Œì´ë¸” ëª¨ë¸ ì •ì˜ (`status` defaultÂ "waiting")
* [ ] ì¤‘ë³µ í”„ë¡¬í”„íŠ¸ í•´ì‹œ ì²´í¬ í›„ ì¬ì‚½ì… ë°©ì§€
* [ ] íŠ¸ëœì­ì…˜ ì‹¤íŒ¨ ì‹œ ë¡¤ë°± & ì˜¤ë¥˜ ë¡œê¹…

---

### ENDâ€‘TOâ€‘END QA ì²´í¬ë¦¬ìŠ¤íŠ¸

*

*
